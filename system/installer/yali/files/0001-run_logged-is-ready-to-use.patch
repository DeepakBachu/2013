From c4fc591908f929ee222a23b6ae2f675f1d02b874 Mon Sep 17 00:00:00 2001
From: mete <mete@26e1f6f6-46e4-0310-a0b7-a8a415fd4c45>
Date: Wed, 29 Dec 2010 09:13:43 +0000
Subject: [PATCH] run_logged is ready to use.

git-svn-id: https://svn.pardus.org.tr/uludag/trunk/yali@34508 26e1f6f6-46e4-0310-a0b7-a8a415fd4c45
---
 yali/context.py            |    4 ++++
 yali/storage/bootloader.py |    2 +-
 yali/util.py               |    4 ++--
 3 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/yali/context.py b/yali/context.py
index 7bf7523..b857b9d 100644
--- a/yali/context.py
+++ b/yali/context.py
@@ -35,6 +35,10 @@ kernels = {defaultKernel:"kernel.default",
            paeKernel:"kernel.pae",
            rtKernel:"kernel.rt"}
 
+stdout = None
+
+stderr = None
+
 logger = None
 
 storage = None
diff --git a/yali/storage/bootloader.py b/yali/storage/bootloader.py
index f175712..2f7d52b 100644
--- a/yali/storage/bootloader.py
+++ b/yali/storage/bootloader.py
@@ -405,6 +405,6 @@ quit
 
 
     def install(self):
-        rc = yali.util.run_logged("grub", ["--no-floppy", "--batch < ", "/tmp/batch"])[0]
+        rc = yali.util.run_batch("grub", ["--no-floppy", "--batch < ", "/tmp/batch"])[0]
         yali.util.sync()
         return rc
diff --git a/yali/util.py b/yali/util.py
index 127aa65..57906ed 100644
--- a/yali/util.py
+++ b/yali/util.py
@@ -153,7 +153,7 @@ def run_logged(cmd, argv):
     if ctx.stderr:
         stderr = ctx.stderr
     else:
-        if ctx.flags('debug'):
+        if ctx.flags.debug:
             stderr = None
         else:
             stderr = subprocess.STDOUT
@@ -165,7 +165,7 @@ def run_logged(cmd, argv):
     ctx.logger.debug('output for "%(command)s" is %(output)s' % {"command":cmd, "output":out})
     ctx.logger.debug('error value for "%(command)s" is %(error)s' % {"command":cmd, "error":error})
 
-    return p.returncode
+    return (p.returncode, out, error)
 
 efi = None
 def isEfi():
-- 
1.7.3.4

