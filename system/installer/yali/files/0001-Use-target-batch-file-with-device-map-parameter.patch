From db037eb826e69a3847130368127532d95c03ea20 Mon Sep 17 00:00:00 2001
From: mete <mete@26e1f6f6-46e4-0310-a0b7-a8a415fd4c45>
Date: Fri, 14 Jan 2011 11:04:32 +0000
Subject: [PATCH] Use target batch file with device-map parameter.

git-svn-id: https://svn.pardus.org.tr/uludag/trunk/yali@35088 26e1f6f6-46e4-0310-a0b7-a8a415fd4c45
---
 yali/storage/bootloader.py |    6 +++---
 1 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/yali/storage/bootloader.py b/yali/storage/bootloader.py
index 8404585..8fde3fd 100644
--- a/yali/storage/bootloader.py
+++ b/yali/storage/bootloader.py
@@ -256,7 +256,7 @@ class BootLoader(object):
             ctx.logger.debug("Target grub.conf file is writing")
             self.writeGrubInstallConf(os.path.join(target_conf_dir, "grub.conf"), removableExists=False)
 
-        self.writeGrubInstallConf("/tmp/batch", removableExists=self.removableExists)
+        yali.util.cp(os.path.join(target_conf_dir, "/tmp/batch")
         self.appendOtherSystems()
 
     def appendOtherSystems(self):
@@ -394,7 +394,7 @@ quit
         file(path,'w').write(batch_template)
 
 
-    def install(self, batch=True):
+    def install(self, batch=False):
         if batch:
             return self.install_batch()
         else:
@@ -406,6 +406,6 @@ quit
         return rc
 
     def install_devicemap(self):
-        rc = yali.util.run_batch("grub", ["--no-floppy", "--devicemap=/tmp/device.map"])[0]
+        rc = yali.util.run_batch("grub", ["--no-floppy", "--device-map=/tmp/device.map", "--batch < ", "/tmp/batch"])[0]
         yali.util.sync()
         return rc
-- 
1.7.3.4

