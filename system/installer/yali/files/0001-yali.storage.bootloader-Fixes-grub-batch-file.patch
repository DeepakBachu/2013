From 5035909f0728e2be125845cac9b45e820d8eb03c Mon Sep 17 00:00:00 2001
From: Mete Alpaslan <mete@pardus.org.tr>
Date: Thu, 2 Dec 2010 01:08:21 +0200
Subject: [PATCH 1/2] yali.storage.bootloader:Fixes grub batch file

OpticalDevices are all removable and iso9660 format type.

BUG:FIXED:15401
---
 yali/storage/bootloader.py |    4 ++--
 yali/storage/devicetree.py |    2 +-
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/yali/storage/bootloader.py b/yali/storage/bootloader.py
index ee50564..319d145 100644
--- a/yali/storage/bootloader.py
+++ b/yali/storage/bootloader.py
@@ -388,8 +388,8 @@ class BootLoader(object):
         stage1Devices = get_physical_devices(self.storage, self.storage.devicetree.getDeviceByName(self.device))
         bootDevices = get_physical_devices(self.storage, self.storage.storageset.bootDevice)
 
-        stage1Path = get_partition_name(self.storage, stage1Devices[0], exists=ctx.bootloader.removableExists)
-        bootPartitionPath = get_partition_name(self.storage, bootDevices[0], exists=ctx.bootloader.removableExists)
+        stage1Path = get_partition_name(self.storage, stage1Devices[0], exists=self.removableExists)
+        bootPartitionPath = get_partition_name(self.storage, bootDevices[0], exists=self.removableExists)
 
         batch_template = """root %s
 setup %s
diff --git a/yali/storage/devicetree.py b/yali/storage/devicetree.py
index bb6de67..9df81ef 100644
--- a/yali/storage/devicetree.py
+++ b/yali/storage/devicetree.py
@@ -1082,7 +1082,7 @@ class DeviceTree(object):
                 # we fall through to handle that.
                 return
 
-        if device.removable and format_type == "iso9660":
+        if not isinstance(device, OpticalDevice) and device.removable and format_type == "iso9660":
             ctx.logger.debug("Removable device %s is iso9660 format. We have to remove from devices index" % device.name)
             if ctx.bootloader:
                 ctx.bootloader.removableExists = True
-- 
1.7.2.2

