Index: kgpg/editor/kgpgeditor.cpp
===================================================================
--- kgpg/editor/kgpgeditor.cpp	(revision 1230071)
+++ kgpg/editor/kgpgeditor.cpp	(revision 1232838)
@@ -169,7 +169,7 @@
     KStandardAction::find(this, SLOT(slotFind()), actionCollection());
     KStandardAction::findNext(this, SLOT(slotFindNext()), actionCollection());
     KStandardAction::findPrev(this, SLOT(slotFindPrev()), actionCollection());
-    actionCollection()->addAction(KStandardAction::Preferences, QLatin1String( "kgpg_config" ),
+    actionCollection()->addAction(KStandardAction::Preferences, QLatin1String( "options_configure" ),
                                   this, SLOT(slotOptions()));
 
     m_editundo = KStandardAction::undo(this, SLOT(slotundo()), actionCollection());
Index: kgpg/editor/kgpgeditor.rc
===================================================================
--- kgpg/editor/kgpgeditor.rc	(revision 1230071)
+++ kgpg/editor/kgpgeditor.rc	(revision 1232838)
@@ -20,11 +20,6 @@
         <Action name="sign_verify"/>
         <Action name="sign_check"/>
     </Menu>
-
-    <Menu name="settings">
-        <text>&amp;Settings</text>
-        <Action name="kgpg_config" />
-    </Menu>
 </MenuBar>
 <ToolBar name="gpgToolBar">
   <Action name="text_sign_verify"/>
Index: kdeutils-version.h
===================================================================
--- kdeutils-version.h	(revision 1230071)
+++ kdeutils-version.h	(revision 1232838)
@@ -58,6 +58,6 @@
     3.2 alpha1
 */
 
-#define KDEUTILS_VERSION_STRING "4.6.2"
+#define KDEUTILS_VERSION_STRING "4.6.4"
 
 #endif
Index: printer-applet/printer-applet.notifyrc
===================================================================
--- printer-applet/printer-applet.notifyrc	(revision 1230071)
+++ printer-applet/printer-applet.notifyrc	(revision 1232838)
@@ -159,7 +159,7 @@
 Comment[ca@valencia]=S'està configurant la impressora nova
 Comment[cs]=Probíhá nastavení nové tiskárny
 Comment[da]=Indstilling af ny printer
-Comment[de]=Neuen Drucker einrichten
+Comment[de]=Neuer Drucker wird eingerichtet
 Comment[el]=Ρύθμιση νέου εκτυπωτή
 Comment[en_GB]=Configuring New Printer
 Comment[es]=Configuración de la nueva impresora
Index: filelight/misc/filelight.desktop
===================================================================
--- filelight/misc/filelight.desktop	(revision 1230071)
+++ filelight/misc/filelight.desktop	(revision 1232838)
@@ -12,6 +12,7 @@
 Name[eu]=Filelight
 Name[fi]=Filelight
 Name[fr]=Filelight
+Name[hu]=Filelight
 Name[it]=Filelight
 Name[kk]=Filelight
 Name[km]=Filelight
@@ -23,6 +24,7 @@
 Name[pa]=ਫਾਇਲਲਾਈਟ
 Name[pt]=Filelight
 Name[pt_BR]=Filelight
+Name[ro]=Filelight
 Name[ru]=Filelight
 Name[sk]=Filelight
 Name[sl]=Filelight
@@ -52,6 +54,7 @@
 GenericName[eu]=Diskoen erabilerari buruzko estatistikak
 GenericName[fi]=Levynkäyttötilastot
 GenericName[fr]=Statistiques d'utilisation de disque
+GenericName[hu]=Lemezhasználati statisztika
 GenericName[it]=Statistiche uso del disco
 GenericName[kk]=Дискінің статистикасы
 GenericName[km]=ស្ថិតិ​ប្រើប្រាស់​ថាស
@@ -63,6 +66,7 @@
 GenericName[pa]=ਡਿਸਕ ਵਰਤੋਂ ਅੰਕੜੇ
 GenericName[pt]=Estatísticas de Utilização do Disco
 GenericName[pt_BR]=Estatísticas do uso do disco
+GenericName[ro]=Statistici utilizare disc
 GenericName[ru]=Использование дисков
 GenericName[sk]=Štatistiky využitia disku
 GenericName[sl]=Statistika porabe diska
@@ -93,6 +97,7 @@
 Comment[eu]=Erakutsi diskoen erabilerari buruzko informazioa
 Comment[fi]=Näytä levynkäyttö
 Comment[fr]=Afficher l'information d'utilisation de disque
+Comment[hu]=Lemezhasználati információk megjelenítése
 Comment[it]=Mostra l'uso del disco
 Comment[kk]=Дискідегі орынды көрсету
 Comment[km]=មើល​ព័ត៌មាន​អំពី​ការ​ប្រើប្រាស់​ថាស
@@ -104,6 +109,7 @@
 Comment[pa]=ਡਿਸਕ ਵਰਤੋਂ ਬਾਰੇ ਜਾਣਕਾਰੀ ਵੇਖੋ
 Comment[pt]=Ver a informação de utilização do disco
 Comment[pt_BR]=Exibe as informações de utilização do disco
+Comment[ro]=Vezi informații despre utilizarea discului
 Comment[ru]=Наглядное представление файловой системы
 Comment[sk]=Zobrazenie informácií o využití disku
 Comment[sl]=Oglejte si statistiko porabe diska
Index: filelight/misc/filelightpart.desktop
===================================================================
--- filelight/misc/filelightpart.desktop	(revision 1230071)
+++ filelight/misc/filelightpart.desktop	(revision 1232838)
@@ -22,6 +22,7 @@
 Name[pa]=ਰੇਡੀਅਨ ਮੈਪ
 Name[pt]=Mapa Radial
 Name[pt_BR]=Mapa radial
+Name[ro]=Hartă radială
 Name[ru]=Радиальная карта
 Name[sk]=Radiálna mapa
 Name[sl]=Krožen prikaz
Index: ark/plugins/CMakeLists.txt
===================================================================
--- ark/plugins/CMakeLists.txt	(revision 1230071)
+++ ark/plugins/CMakeLists.txt	(revision 1232838)
@@ -1,5 +1,3 @@
-macro_optional_find_package(LibArchive)
-
 if (LIBARCHIVE_FOUND)
     if( HAVE_LIBARCHIVE_READ_DISK_API )
         if( NOT HAVE_LIBARCHIVE_LZMA_SUPPORT OR NOT HAVE_LIBARCHIVE_XZ_SUPPORT )
@@ -15,8 +13,6 @@
     endif( HAVE_LIBARCHIVE_READ_DISK_API )
 endif (LIBARCHIVE_FOUND)
 
-macro_log_feature(LIBARCHIVE_FOUND "LibArchive" "A library for dealing with a wide variety of archive file formats" "http://code.google.com/p/libarchive/" FALSE "" "Required for among others tar, tar.gz, tar.bz2 formats in Ark.")
-
 add_subdirectory( clirarplugin )
 add_subdirectory( cli7zplugin )
 add_subdirectory( clizipplugin )
Index: ark/part/archivemodel.cpp
===================================================================
--- ark/part/archivemodel.cpp	(revision 1230071)
+++ ark/part/archivemodel.cpp	(revision 1232838)
@@ -60,8 +60,10 @@
 
     static bool compareAscending(const QPair<ArchiveNode*,int> &a, const QPair<ArchiveNode*,int> &b) {
         // #234373: sort folders before files
-        if (a.first->isDir() != b.first->isDir()) {
-            return a.first->isDir();
+        if ((a.first->isDir()) && (!b.first->isDir())) {
+            return true;
+        } else if ((!a.first->isDir()) && (b.first->isDir())) {
+            return false;
         }
 
         if (currentSortColumn == FileName) {
@@ -76,8 +78,10 @@
 
     static bool compareDescending(const QPair<ArchiveNode*,int> &a, const QPair<ArchiveNode*,int> &b) {
         // #234373: sort folders before files
-        if (a.first->isDir() != b.first->isDir()) {
-            return !(a.first->isDir());
+        if ((a.first->isDir()) && (!b.first->isDir())) {
+            return true;
+        } else if ((!a.first->isDir()) && (b.first->isDir())) {
+            return false;
         }
 
         if (currentSortColumn == FileName) {
@@ -435,9 +439,9 @@
         }
 
         if (order == Qt::AscendingOrder) {
-            qSort(sorting.begin(), sorting.end(), ArchiveNode::compareAscending);
+            qStableSort(sorting.begin(), sorting.end(), ArchiveNode::compareAscending);
         } else {
-            qSort(sorting.begin(), sorting.end(), ArchiveNode::compareDescending);
+            qStableSort(sorting.begin(), sorting.end(), ArchiveNode::compareDescending);
         }
 
         QModelIndexList fromIndexes;
@@ -480,28 +484,15 @@
 QMimeData * ArchiveModel::mimeData(const QModelIndexList & indexes) const
 {
     kDebug();
-    //prepare the fallback kio_slave filenames
     QStringList files;
-    bool noFallback = false;
 
     QString archiveName = m_archive->fileName();
-    QString ext = QFileInfo(archiveName).suffix().toUpper();
-    if (ext == QLatin1String( "TAR" )) {
-        archiveName.prepend(QLatin1String( "tar:" ));
-    } else if (ext == QLatin1String( "ZIP" )) {
-        archiveName.prepend(QLatin1String( "zip:" ));
-    } else if (archiveName.right(6).toUpper() == QLatin1String( "TAR.GZ" )) {
-        archiveName.prepend(QLatin1String( "tar:" ));
-    } else
-        noFallback = true;
-
-    if (!archiveName.endsWith(QLatin1Char( '/' ))) {
-        archiveName.append(QLatin1Char( '/' ));
+    if (!archiveName.endsWith(QLatin1Char('/'))) {
+        archiveName.append(QLatin1Char('/'));
     }
 
     //Populate the internal list of files
     foreach(const QModelIndex &index, indexes) {
-
         //to limit only one index per row
         if (index.column() != 0) {
             continue;
@@ -511,18 +502,12 @@
         files << file;
     }
 
-    KUrl::List kiolist(files);
-
     //prepare the dbus-based drag/drop mimedata
     QMimeData *data = new QMimeData();
-    data->setData(QLatin1String( "application/x-kde-dndextract" ),
+    data->setData(QLatin1String("application/x-kde-dndextract"),
                   QDBusConnection::sessionBus().baseService().toUtf8()
                  );
 
-
-    if (!noFallback) {
-        kiolist.populateMimeData(data);
-    }
     return data;
 }
 
@@ -568,16 +553,14 @@
 // For a rationale, see bugs #194241 and #241967
 QString ArchiveModel::cleanFileName(const QString& fileName)
 {
-    QString cleanName(fileName);
-
-    if ((cleanName == QLatin1String("/")) ||
-        (cleanName == QLatin1String("."))) { // "." is present in ISO files
-        cleanName.clear();
-    } else if (cleanName.startsWith(QLatin1String("./"))) {
-        cleanName.remove(0, 2);
+    if ((fileName == QLatin1String("/")) ||
+        (fileName == QLatin1String("."))) { // "." is present in ISO files
+        return QString();
+    } else if (fileName.startsWith(QLatin1String("./"))) {
+        return fileName.mid(2);
     }
 
-    return cleanName;
+    return fileName;
 }
 
 ArchiveDirNode* ArchiveModel::parentFor(const ArchiveEntry& entry)
Index: ark/part/part.cpp
===================================================================
--- ark/part/part.cpp	(revision 1230071)
+++ ark/part/part.cpp	(revision 1232838)
@@ -88,9 +88,12 @@
     m_splitter = new QSplitter(Qt::Horizontal, parentWidget);
     setWidget(m_splitter);
 
-    m_view = new ArchiveView(m_splitter);
-    m_infoPanel = new InfoPanel(m_model, m_splitter);
+    m_view = new ArchiveView;
+    m_infoPanel = new InfoPanel(m_model);
 
+    m_splitter->addWidget(m_view);
+    m_splitter->addWidget(m_infoPanel);
+
     QList<int> splitterSizes = ArkSettings::splitterSizes();
     if (splitterSizes.isEmpty()) {
         splitterSizes.append(200);
@@ -148,6 +151,9 @@
     connect(job, SIGNAL(result(KJob*)), this, SIGNAL(ready()));
 }
 
+// TODO: One should construct a KUrl out of localPath in order to be able to handle
+//       non-local destinations (ie. trash:/ or a remote location)
+//       See bugs #189322 and #204323.
 void Part::extractSelectedFilesTo(const QString& localPath)
 {
     kDebug() << "Extract to " << localPath;
@@ -749,8 +755,21 @@
 void Part::slotAddFiles()
 {
     kDebug();
-    const QStringList filesToAdd = KFileDialog::getOpenFileNames(KUrl("kfiledialog:///ArkAddFiles"), QString(), widget(), i18nc("@title:window", "Add Files"));
 
+    // #264819: passing widget() as the parent will not work as expected.
+    //          KFileDialog will create a KFileWidget, which runs an internal
+    //          event loop to stat the given directory. This, in turn, leads to
+    //          events being delivered to widget(), which is a QSplitter, which
+    //          in turn reimplements childEvent() and will end up calling
+    //          QWidget::show() on the KFileDialog (thus showing it in a
+    //          non-modal state).
+    //          When KFileDialog::exec() is called, the widget is already shown
+    //          and nothing happens.
+    const QStringList filesToAdd =
+        KFileDialog::getOpenFileNames(KUrl("kfiledialog:///ArkAddFiles"),
+                                      QString(), widget()->parentWidget(),
+                                      i18nc("@title:window", "Add Files"));
+
     slotAddFiles(filesToAdd);
 }
 
Index: ark/kerfuffle/adddialog.cpp
===================================================================
--- ark/kerfuffle/adddialog.cpp	(revision 1230071)
+++ ark/kerfuffle/adddialog.cpp	(revision 1232838)
@@ -2,7 +2,7 @@
  * ark -- archiver for the KDE project
  *
  * Copyright (C) 2008 Harald Hvaal <haraldhv@stud.ntnu.no>
- * Copyright (C) 2009 Raphael Kubo da Costa <kubito@gmail.com>
+ * Copyright (C) 2009,2011 Raphael Kubo da Costa <kubito@gmail.com>
  *
  * Redistribution and use in source and binary forms, with or without
  * modification, are permitted provided that the following conditions
@@ -58,6 +58,7 @@
 {
     setOperationMode(KFileDialog::Saving);
     setMode(KFile::File | KFile::LocalOnly);
+    setConfirmOverwrite(true);
     setCaption(i18n("Compress to Archive"));
 
     loadConfiguration();
@@ -71,7 +72,11 @@
 
     // Set up a default name if there's only one file to compress
     if (itemsToAdd.size() == 1) {
-        setSelection(QFileInfo(itemsToAdd.first()).baseName());
+        // #272914: Add an extension when it is present, otherwise KFileDialog
+        // will not automatically add it as baseFileName is a file which
+        // already exists.
+        const QString baseFileName = QFileInfo(itemsToAdd.first()).baseName();
+        setSelection(baseFileName + currentFilterMimeType()->mainExtension());
     }
 
     //These extra options will be implemented in a 4.2+ version of
Index: ark/CMakeLists.txt
===================================================================
--- ark/CMakeLists.txt	(revision 1230071)
+++ ark/CMakeLists.txt	(revision 1232838)
@@ -1,5 +1,8 @@
 project(ark)
 
+macro_optional_find_package(LibArchive)
+macro_log_feature(LIBARCHIVE_FOUND "LibArchive" "A library for dealing with a wide variety of archive file formats" "http://code.google.com/p/libarchive/" FALSE "" "Required for among others tar, tar.gz, tar.bz2 formats in Ark.")
+
 configure_file(config.h.cmake ${CMAKE_CURRENT_BINARY_DIR}/config.h)
 
 add_subdirectory(part)
