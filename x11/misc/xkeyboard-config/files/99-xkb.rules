ACTION!="add|change", GOTO="xkb_end"
ENV{ID_INPUT_KEYBOARD}!="?*", GOTO="xkb_end"

IMPORT{cmdline}="xkeymap"

ENV{xkeymap}=="?*", PROGRAM="/bin/sh -c '/bin/echo $env{xkeymap} | tr : \\t'", ENV{xkblayout}="%c{1}"
ENV{xkeymap}=="?*:?*", ENV{xkbvariant}="%c{2}"

ENV{xkeymap}=="?*", GOTO="xkb_end"

# If a cmdline option is not given, use the configuration snippet.
ENV{ID_INPUT.tags}="use_configured_snippet"

IMPORT{file}="/etc/env.d/03locale"
ENV{LANG}=="?*", PROGRAM="/bin/sh -c '/bin/echo $${LANG,,} | tr .@_ \\t'", ENV{.language}="%c{1}", ENV{.territory}="%c{2}"

ENV{.language}=="ar", ENV{xkblayout}="ara", GOTO="xkb_end"
ENV{.language}=="el", ENV{xkblayout}="gr", GOTO="xkb_end"
ENV{.language}=="es", ENV{.territory}!="es", ENV{xkblayout}="latam", GOTO="xkb_end"
ENV{.language}=="sr", ENV{xkblayout}="rs", GOTO="xkb_end"
ENV{.language}=="tr", ENV{xkblayout}="tr", GOTO="xkb_end"

ENV{.territory}=="nl", ENV{xkblayout}="us", ENV{xkbvariant}="intl"

ENV{.territory}=="?*", ENV{xkblayout}="$env{.territory}"

LABEL="xkb_end"
